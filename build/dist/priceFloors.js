(self.pbjsChunk=self.pbjsChunk||[]).push([[60],{6823:function(e,t,n){var r=n(1002);function o(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=n(4942),a=n(4358),c=n(265),u=n(4806),s=n(8640),l=n(3193),d=n(8928),f=n(2021),m=n(5644),p=n(2797),h=n(9626),v=n(4614),g=n(5102),y=n(5975),b=n(5383),O=["modelGroups"];function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C,F="Price Floors",S=(0,d.O)(1e4),R=["gptSlot","adUnitCode","size","domain","mediaType"],T=!1,Z=!1,D={},w=[],x={};function P(e,t){return Math.ceil((parseFloat(e)*Math.pow(10,t)).toFixed(1))/Math.pow(10,t)}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.index,o=void 0===r?b.K.index:r;return(null==e?void 0:e.adUnitCode)||o.getAdUnit(t).code}var U={size:function(e,t){return(0,a.s)(t.size)||"*"},mediaType:function(e,t){return t.mediaType||"banner"},gptSlot:function(e,t){return function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).index,n=(void 0===t?b.K.index:t).getAdUnit({transactionId:e});return"gam"===(0,c.Z)(n,"ortb2Imp.ext.data.adserver.name")&&n.ortb2Imp.ext.data.adserver.adslot}((e||t).transactionId)||(0,a.ky)(I(e,t)).gptSlot},domain:function(){return null==C&&(C=(0,a.en)((0,g.nH)().topmostLocation,{noDecodeWholeUrl:!0}).hostname),C},adUnitCode:function(e,t){return I(e,t)}};function M(e,t,n){return e.reduce((function(e,r){var o=U[r](t,n)||"*";return e.push("*"===o?["*"]:[o.toLowerCase(),"*"]),e}),[])}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=M((0,c.Z)(e,"schema.fields")||[],t,n);if(!r.length)return{matchingFloor:e.default};var o=r.map((function(e){return e[0]})).join("-"),i=(0,c.Z)(e,"matchingInputs.".concat(o));if(i)return k({},i);var a=E(r,(0,c.Z)(e,"schema.delimiter")||"|"),s=(0,v.sE)(a,(function(t){return e.values.hasOwnProperty(t)})),l={floorMin:e.floorMin||0,floorRuleValue:isNaN(e.values[s])?e.default:e.values[s],matchingData:a[0],matchingRule:s};return"number"==typeof(0,c.Z)(t,"ortb2Imp.ext.prebid.floorMin")&&(l.floorMin=t.ortb2Imp.ext.prebid.floorMin),l.matchingFloor=Math.max(l.floorMin,l.floorRuleValue),(0,u.Z)(e,"matchingInputs.".concat(o),k({},l)),l}function E(e,t){return e.reduce((function(e,n){var r=[];return e.map((function(e){n.map((function(n){r.push(e+t+n)}))})),r})).sort((function(e,t){return e.split("*").length-t.split("*").length}))}function B(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=y.S.get(e,"bidCpmAdjustment");return r?parseFloat(r(t,k(k({},n),{},{cpm:t}))):parseFloat(t)}function N(e,t){var n=Math.pow(10,10);return e*n/(t*n)*(e*n)/n}var V={banner:function(e){return(0,c.Z)(e,"mediaTypes.banner.sizes")||[]},video:function(e){return(0,c.Z)(e,"mediaTypes.video.playerSize")||[]},native:function(e){return(0,c.Z)(e,"mediaTypes.native.image.sizes")?[(0,c.Z)(e,"mediaTypes.native.image.sizes")]:[]}};function z(e,t){var n=Object.keys(e.mediaTypes||{});return"*"===t.mediaType&&1===n.length&&(t.mediaType=n[0]),"*"===t.size&&-1!==n.indexOf(t.mediaType)&&V[t.mediaType]&&1===V[t.mediaType](e).length&&(t.size=V[t.mediaType](e)[0]),t}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{currency:"USD",mediaType:"*",size:"*"},t=this,n=x[t.auctionId];if(!n||n.skipped)return{};e=z(t,e);var r=A(n.data,k({},t),{mediaType:e.mediaType,size:e.size}),o=e.currency||n.data.currency;if(r.matchingFloor&&o!==n.data.currency)try{r.matchingFloor=(0,s.R)().convertCurrency(r.matchingFloor,n.data.currency,o)}catch(e){(0,a.yN)("".concat(F,": Unable to get currency conversion for getFloor for bidder ").concat(t.bidder,". You must have currency module enabled with defaultRates in your currency config")),o=n.data.currency}if(n.enforcement.bidAdjustment&&r.matchingFloor){var i=B(t.bidder,r.matchingFloor);r.matchingFloor=i?N(r.matchingFloor,i):r.matchingFloor}return r.matchingFloor?{floor:P(r.matchingFloor,4),currency:o}:{}}function G(e,t){var n=(0,a.I8)(e);return n.schema.delimiter=e.schema.delimiter||"|",n.values=function(e,t){var n=e.schema.fields,r=e.schema.delimiter,o=t&&-1===n.indexOf("adUnitCode")&&n.unshift("adUnitCode");return Object.keys(e.values).reduce((function(n,i){return n[(o?"".concat(t).concat(r).concat(i):i).toLowerCase()]=e.values[i],n}),{})}(n,t),n.currency=n.currency||"USD",n}function H(e,t){var n=(0,a.I8)(D);if(2===(0,c.Z)(n,"data.floorsSchemaVersion")){var r=n.data,i=r.modelGroups,u=o(r,O);n.data=Object.assign(u,function(e,t){for(var n=Math.floor(Math.random()*t+1),r=0;r<e.length;r++)if((n-=e[r].modelWeight)<=0)return e[r]}(i,u.modelWeightSum))}var s=0===Object.keys((0,c.Z)(n,"data.values")||{}).length;if(n.data=s?function(e){return e.reduce((function(e,t){if(L(t.floors))if(e.values){var n=G(t.floors,t.code).values;Object.assign(e.values,n)}else(e=G(t.floors,t.code)).location="adUnit";return e}),{})}(e):G(n.data),0===Object.keys((0,c.Z)(n,"data.values")||{}).length)n.skipped=!0;else{var l=(0,a.rD)("pbjs_skipRate")||n.skipRate,d=100*Math.random()<parseFloat(l);n.skipped=d}return n.hasOwnProperty("floorMin")&&(n.data.floorMin=n.floorMin),function(e,t,n){e.forEach((function(e){e.bids.forEach((function(e){t.skipped?delete e.getFloor:e.getFloor=q,e.auctionId=n,e.floorData={skipped:t.skipped,skipRate:t.skipRate,floorMin:t.floorMin,modelVersion:(0,c.Z)(t,"data.modelVersion"),modelWeight:(0,c.Z)(t,"data.modelWeight"),modelTimestamp:(0,c.Z)(t,"data.modelTimestamp"),location:(0,c.Z)(t,"data.location","noData"),floorProvider:t.floorProvider,fetchStatus:D.fetchStatus}}))}))}(e,n,t),n}function W(e){e.hasExited||(w=w.filter((function(t){return t.timer!==e.timer})),e.reqBidsConfigObj.auctionId=e.reqBidsConfigObj.auctionId||(0,a.DO)(),x[e.reqBidsConfigObj.auctionId]=H(e.reqBidsConfigObj.adUnits||(0,s.R)().adUnits,e.reqBidsConfigObj.auctionId),e.nextFn.apply(e.context,[e.reqBidsConfigObj]),e.hasExited=!0)}function J(e){return t=(0,c.Z)(e,"schema.fields"),!!(Array.isArray(t)&&t.length>0&&t.every((function(e){return-1!==R.indexOf(e)}))||((0,a.H)("".concat(F,": Fields recieved do not match allowed fields")),0))&&(n=e,o=e.schema.fields.length,i=e.schema.delimiter||"|","object"===(0,r.Z)(n.values)&&(n.values=Object.keys(n.values).reduce((function(e,t){return function(e,t,n,r){return"string"==typeof e&&e.split(r).length===n&&"number"==typeof t}(t,n.values[t],o,i)&&(e[t]=n.values[t]),e}),{}),Object.keys(n.values).length>0));var t,n,o,i}var K={1:function(e){return J(e)},2:function(e){return!(!Array.isArray(e.modelGroups)||0===e.modelGroups.length)&&(e.modelWeightSum=0,e.modelGroups.every((function(t){return!("number"!=typeof t.modelWeight||!J(t))&&(e.modelWeightSum+=t.modelWeight,!0)})))}};function L(e){return"object"===(0,r.Z)(e)&&(e.floorsSchemaVersion=e.floorsSchemaVersion||1,"function"!=typeof K[e.floorsSchemaVersion]?((0,a.H)("".concat(F,": Unknown floorsSchemaVersion: "),e.floorsSchemaVersion),!1):K[e.floorsSchemaVersion](e))}function _(e,t){if(e&&"object"===(0,r.Z)(e)&&L(e))return(0,a.PN)("".concat(F,": A ").concat(t," set the auction floor data set to "),e),k(k({},e),{},{location:t});(0,a.H)("".concat(F,": The floors data did not contain correct values"),e)}function Q(e,t){var n={reqBidsConfigObj:t,context:this,nextFn:e,haveExited:!1,timer:null};D.auctionDelay>0&&T?(n.timer=setTimeout((function(){(0,a.yN)("".concat(F,": Fetch attempt did not return in time for auction")),D.fetchStatus="timeout",W(n)}),D.auctionDelay),w.push(n)):W(n)}function Y(){w.forEach((function(e){clearTimeout(e.timer),W(e)})),w=[]}function X(e){var t;T=!1,D.fetchStatus="success";try{t=JSON.parse(e)}catch(n){t=e}var n=_(t,"fetch");n&&(D.data=n,D.skipRate=(0,a.hj)(n.skipRate)?n.skipRate:D.skipRate,D.floorProvider=n.floorProvider||D.floorProvider),Y()}function $(e){T=!1,D.fetchStatus="error",(0,a.H)("".concat(F,": Fetch errored with: "),e),Y()}function ee(e){var t;(D=(0,a.ei)(e,["floorMin","enabled",function(e){return!1!==e},"auctionDelay",function(e){return e||0},"floorProvider",function(t){return(0,c.Z)(e,"data.floorProvider",t)},"endpoint",function(e){return e||{}},"skipRate",function(){return isNaN((0,c.Z)(e,"data.skipRate"))?e.skipRate||0:e.data.skipRate},"enforcement",function(e){return(0,a.ei)(e||{},["enforceJS",function(e){return!1!==e},"enforcePBS",function(e){return!0===e},"floorDeals",function(e){return!0===e},"bidAdjustment",function(e){return!1!==e}])},"additionalSchemaFields",function(e){return"object"===(0,r.Z)(e)&&Object.keys(e).length>0?(t=e,void Object.keys(t).forEach((function(e){-1===R.indexOf(e)&&"function"==typeof t[e]&&(R.push(e),U[e]=t[e])}))):void 0;var t},"data",function(e){return e&&_(e,"setConfig")||D.data}])).enabled?((t=D.endpoint).url&&!T?"GET"!==(t.method||"GET")?(0,a.H)("".concat(F,": 'GET' is the only request method supported at this time!")):(S(t.url,{success:X,error:$},null,{method:"GET"}),T=!0):T&&(0,a.yN)("".concat(F,": A fetch is already occuring. Skipping.")),Z||(f.on(m.FP.AUCTION_END,(function(e){setTimeout((function(){return delete x[e.auctionId]}),3e3)})),(0,s.R)().requestBids.before(Q,50),(0,p.v5)("addBidResponse").before(te,(0,a.eB)()?4:50),Z=!0)):((0,a.PN)("".concat(F,": Turning off module")),D={},x={},(0,p.v5)("addBidResponse").getHooks({hook:te}).remove(),(0,s.R)().requestBids.getHooks({hook:Q}).remove(),Z=!1)}function te(e,t,n){var r=x[n.auctionId];if(!r||!n||r.skipped)return e.call(this,t,n);var o,i=b.K.index.getBidRequest(n),u=A(r.data,i,k(k({},n),{},{size:[n.width,n.height]}));if(!u.matchingFloor)return(0,a.yN)("".concat(F,": unable to determine a matching price floor for bidResponse"),n),e.call(this,t,n);var l=r.data.currency.toUpperCase(),d=n.currency||"USD";if(l===d.toUpperCase())o=n.cpm;else if(n.originalCurrency&&l===n.originalCurrency.toUpperCase())o=n.originalCpm;else try{o=(0,s.R)().convertCurrency(n.cpm,d.toUpperCase(),l)}catch(r){return(0,a.H)("".concat(F,": Unable do get currency conversion for bidResponse to Floor Currency. Do you have Currency module enabled? ").concat(n)),e.call(this,t,n)}if(function(e,t,n,r){n.floorData={floorValue:t.matchingFloor,floorRule:t.matchingRule,floorRuleValue:t.floorRuleValue,floorCurrency:e.data.currency,cpmAfterAdjustments:r,enforcements:k({},e.enforcement),matchedFields:{}},e.data.schema.fields.forEach((function(r,o){var i=t.matchingData.split(e.data.schema.delimiter)[o];n.floorData.matchedFields[r]=i}))}(r,u,n,o=B(n.bidderCode,o,n)),function(e,t,n){var r=!1!==(0,c.Z)(e,"enforcement.enforceJS"),o=!0===(0,c.Z)(e,"enforcement.floorDeals")||!n.dealId,i=n.floorData.cpmAfterAdjustments<t.matchingFloor;return r&&i&&o}(r,u,n)){var f,p=(0,h.m)(m.Q_.H,n.getIdentifiers());return Object.assign(p,(0,a.ei)(n,["floorData","width","height","mediaType","currency","originalCpm","originalCurrency","getCpmInNewCurrency"])),p.status=m.UE.G9,p.cpm=0,(0,a.yN)("".concat(F,": ").concat(p.bidderCode,"'s Bid Response for ").concat(t," was rejected due to floor not met (adjusted cpm: ").concat(null==n||null===(f=n.floorData)||void 0===f?void 0:f.cpmAfterAdjustments,", floor: ").concat(null==u?void 0:u.matchingFloor,")"),n),e.call(this,t,p)}return e.call(this,t,n)}l.vc.getConfig("floors",(function(e){return ee(e.floors)})),window.pbjs.installedModules.push("priceFloors")}},function(e){var t;t=6823,e(e.s=t)}]);